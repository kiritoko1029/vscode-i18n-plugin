# I18n Plugin 实时更新机制优化

## 问题描述
插件在VSCode中编辑t函数相关文本后存在以下问题：
1. 内联翻译文本在编辑过程中没有正确更新
2. 编辑完成后翻译文本会显示，但即使t函数已删除仍会显示
3. 存在双重刷新导致的时序问题

## 根本原因分析
通过代码分析发现问题源于：
1. 文档变化时同时触发立即刷新和防抖刷新，造成双重处理
2. 立即刷新在编辑过程中干扰用户体验
3. 防抖机制的延迟时间过长（500ms）
4. 缺乏详细的调试日志，难以追踪刷新流程

## 解决方案
采用**方案1：优化文档变化监听机制**

### 核心改进
1. **移除立即刷新**：文档变化时不再立即触发`forceRefresh`
2. **优化防抖机制**：
   - 延迟时间从500ms减少到300ms
   - 确保缓存刷新和装饰器刷新的正确顺序
   - 添加语言类型检查，避免不必要的刷新
3. **增强调试日志**：添加详细的日志跟踪刷新流程
4. **异常处理**：为手动刷新命令添加错误处理机制

### 具体修改
1. `extension.ts - onDidChangeTextDocument`：移除立即刷新，优化防抖逻辑
2. `extension.ts - onDidChangeActiveTextEditor`：保留立即刷新（切换文件时必要）
3. `extension.ts - onDidChangeConfiguration`：优化配置变化处理
4. `extension.ts - refreshCache命令`：添加异步处理和错误处理

## 预期效果
1. 编辑过程中不再有干扰性的立即刷新
2. 编辑完成后300ms内完成翻译更新
3. 删除t函数后装饰器能正确消失
4. 切换文件时保持正常的翻译显示
5. 更清晰的调试日志便于问题排查

## 测试要点
1. 编辑t函数时翻译文本的行为
2. 删除t函数后装饰器是否正确清除
3. 切换文件时的翻译显示
4. 手动刷新命令的执行效果
5. 配置变更时的行为

## 关联文件
- `src/extension.ts`：主要修改文件
- `src/providers/decorationProvider.ts`：装饰器逻辑（未修改）
- `src/services/i18nService.ts`：服务逻辑（未修改） 